#!/usr/bin/env node
const pkg = require(`../package.json`);
const spawn = require(`child_process`).spawn;
const fs = require(`fs`);
const path = require(`path`);
const installation = spawn(
 `npm`,
 [`install`, `--save`, `${pkg.name}@${pkg.version}`],
 {stdio:`inherit`});


 const packageLocation = path.join(process.cwd(), `package.json`);
 let pkg2;
 try{
   pkg2 = require(packageLocation);
 }catch(e){
   pkg2 = {};
 }
 pkg2.scripts = pkg2.scripts || {};
 pkg2.scripts[pkg.name] = `node ./node_modules/scripm/bin/${pkg.name}`;

 fs.writeFileSync(packageLocation, JSON.stringify(pkg2));

const program = require(`commander`);
program
  .version(pkg.version)
  .command(`add <name> [action]`, `Add script`)
  .command(`template <name> <template>`, `Create script from template`)
  .command(`install <template>`, `Install template`)
  .command(`list <repo>`, `list installed templates`)
  .command(`add-repo <repo> <url>`, `add repo`)
  .command(`init`, "initialize")
  .parse(process.argv);
